## index(b+tree)

1. intros

   - wiretriger 的索引实现 b+ tree
   - 同样支持对嵌套字段、数组进行索引

2. types

   - 字段数: 单键索引和组合索引(复合索引)
   - 类型: 主键索引和非主键索引
   - 存储: 聚簇索引和非聚簇索引
   - 特性: 为唯一索引、稀疏索引、文本索引、地理空间索引、地理空间索引、文本检索索引、TTL 索引

3. command

   ```js
   // keys 建立索引的键
   // options 常见的
   //     background: true 不阻塞数据库操作, 默认 false
   //     unique: true 唯一索引, 默认 false
   //     name: 索引名
   //     sparse: true 文档中不存在的字段不起用索引, 默认 false
   //     expireAfterSeconds: ttl 索引
   //     weights: 索引权重值
   db.collection.createIndex(keys, options);

   // 创建索引后台执行
   db.values.createIndex({ open: 1, close: 1 }, { background: true });
   // 创建唯一索引
   db.values.createIndex({ title: 1 }, { unique: true });
   // 创建txt索引
   db.stores.createIndex({ name: 'text', description: 'text' });

   // 查看索引信息
   db.books.getIndexes();
   // 查看索引键
   db.books.getIndexKeys();

   // 查看索引占用空间
   db.collection.totalIndexSize([is_detail]);

   // 删除集合指定索引
   db.col.dropIndex('索引名称');
   // 删除集合所有索引
   db.col.dropIndexes();
   ```

## 单键索引

## 复合索引

## 多键索引

## 地理空间索引

## 全文索引

## Hash 索引

## 通配符索引

## 唯一索引

## 部分索引

## 稀疏索引

## TTL 索引

## 隐藏索引

## optimize

## explain

## mistake

1. mongodb 使用 b-tree: 这是不准确的(是 b+tree)

   - 别人总结下来的使用 b-tree 的好处

     ```js
     1. 因为 B 树中 key 和卫星数据聚合在一起，而 MongoDB 又是聚合型数据库，所以比较适合用 B 树
     2. 在 B 树查找单个数据的时间复杂度最好情况下为 O(1)，比在 B+ 树中查找效率高，而 MongoDB 对性能要求高

     3. MongoDB 认为查询单个数据记录远比遍历数据更加常见，由于 B 树的非叶结点也可以存储数据，所以查询一条数据所需要的平均随机 IO 次数会比 B+ 树少，使用 B 树的 MongoDB 在类似场景中的查询速度就会比 MySQL 快。
     4. MySQL 使用 B+ 树是因为数据的遍历在关系型数据库中非常常见，它经常需要处理各个表之间的关系并通过范围查询一些数据；但是 MongoDB 作为面向文档的数据库，与数据之间的关系相比，它更看重以文档为中心的组织方式，所以选择了查询单个文档性能较好的 B 树，这个选择对遍历数据的查询也可以保证可以接受的时延

     5. 就是一种单一数据查询!毕竟你不需要去逐行匹配，不涉及遍历操作,幸运的情况下，有可能一次IO就能够得到你想要的结果。
     6. 因此，由于关系型数据库和非关系型数据的设计方式上的不同。导致在关系型数据中，遍历操作比较常见，因此采用B+树作为索引，比较合适。而在非关系型数据库中，单一查询比较常见，因此采用B树作为索引，比较合适
     ```

   - 一条一条批驳

     ```js
     1. B+ 树中的叶子节点上，key 和卫星数据聚合在一起, 且这完全算不做理由
     2. B+ 的mysql 也要求高性能的, 且这个效率真的不一定高, 因为树会变深

     3. 同2, 考虑内存中数据和磁盘读取+树高的问题可以得到一下结论
         - 只有在极端情况下, 一次就获取到数据, b-tree 才有性能又是
         - 其他情况下, 单表的查询性能基本持平且b+tree 性能略优
     4. mongo 确实不太需要连表操作, 且连表下b-tree 没有任何优势
     ```

---

## reference

1. https://zhuanlan.zhihu.com/p/519658576
